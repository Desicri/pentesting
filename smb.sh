#!/bin/bash
echo "SMBTEST" #Make a file called ips.txt and put it in the same directory. Have each ip in the file on its own line.

#readarray iparray < ips.txt 
#echo "The IP addresses for this test are:"
#for i in ${iparray[@]} 
#do
#	echo "Testing" $i;
#	echo
#	echo "Running nbtscan..."
#	echo
#	nbtscan $i
#	echo
#	echo "Running enum4linux..."
#	echo
#	enum4linux $i
#	echo
#	echo "Running all nmap smb-vuln scripts..."
#	echo
#	nmap -p 139,445 -v --script "smb-vuln*",smb-os-discovery.nse --script-args=unsafe=1 $i
#done 

smbcheck2 () {
   if [ -z "$1" ]                           
     then
        echo "-Type single ip address you want here- else the system will look for a file in the directory named ips.txt. "  # Or no parameter passed.
	echo "Looking for ips.txt"
		if [ -s ips.txt ]                           
		     	then
			echo "No ips.txt found or ip passed as parameter... exiting."
		else	
			readarray iparray < ips.txt 
			echo "The IP addresses for this test are:"
			for i in ${iparray[@]} 
			do
				echo "Testing" $i;
				echo
				echo "Running nbtscan..."
				echo
				nbtscan $i
				echo
				echo "Running enum4linux..."
				echo
				enum4linux $i
				echo
				echo "Running all nmap smb-vuln scripts..."
				echo
				nmap -p 139,445 -v --script "smb-vuln*",smb-os-discovery.nse --script-args=unsafe=1 $i
			done
		fi
		return 0 
     else 	
		echo "Testing" $1;
		echo
		echo "Running nbtscan..."
		echo
		nbtscan $1
		echo
		echo "Running enum4linux..."
		echo
		enum4linux $1
		echo
		echo "Running all nmap smb-vuln scripts..."
		echo
		nmap -p 139,445 -v --script "smb-vuln*",smb-os-discovery.nse --script-args=unsafe=1 $1
     fi
   return 0
}
smbcheck2 $1

