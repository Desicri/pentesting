#!/bin/bash
#Zone Transfer using SMB
echo $1
echo $2

zoneTransfer1(){  
if [ -z "$1" ]
	then
	echo "Put in an nmap friendly address or range, e.g. 192.168.1.1 or 192.168.1.0/24..."
	
else
	echo "Trying zonetransfer using SMB for domain and scanning for Port 53..."
	echo

	nmap -p 139,445 -v --script smb-os-discovery.nse $1 > newtext #Oddly enough Grep won't capture the sm-discovery script text... so we have to output to a regualr text file

	grep "Domain name" newtext | cut -d " " -f 6 | uniq > domainnames.txt #grepping domain names
	echo "The domain/domains are named:" 
	cat domainnames.txt
	#
	rm newtext
	nmap -p53 $1 -oG dnssites.txt                                
	grep "open" dnssites.txt | cut -d " " -f 2 > dnsarray.txt
	echo
	echo "The ips where port 53 is open are:"
	cat dnsarray.txt
	

	for i in $(cat domainnames.txt)
		do
		echo $i
		for i2 in $(cat dnsarray.txt)
			do 
			host -l $i $i2
			done
		done
fi
return 0
}
	

#CALLING HARVEST FUNCTION
#Calling function to check if a parameter was passed. If nothing is passed this is skipped.
#
echo
zoneTransfer1 "$1" 
echo


if [ -z "$2" ]
	then
	echo "Type the domain as a second parameter to do basic dns zonetransfer check using dnsenum..."
else
	dnsenum $2
fi
